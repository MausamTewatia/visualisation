<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Effect of Social Media on Occupation and Relationship</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 40px;
        background-color: #f0f0f0;
        display: flex;
        flex-direction: column;
        align-items: center;
      }
      #header {
        text-align: center;
        font-size: 28px;
        font-weight: bold;
        margin-bottom: 30px;
        color: #333;
      }
      #container {
        display: flex;
        flex-direction: column;
        align-items: center;
        width: 100%;
        max-width: 1200px;
      }
      .chart {
        background-color: white;
        border-radius: 8px;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        margin-bottom: 40px;
        padding: 30px;
        width: 100%;
      }
      .chart-title {
        font-size: 22px;
        font-weight: bold;
        margin-bottom: 20px;
        text-align: center;
        color: #444;
      }
      .chart svg {
        display: block;
        margin: 0 auto;
      }
      .legend text {
        font-size: 12px;
      }
      .axis-label {
        font-size: 14px;
        font-weight: bold;
      }
    </style>
  </head>
  <body>
    <div id="header">Effect of Social Media on Occupation and Relationship</div>
    <div id="container">
      <div class="chart">
        <div class="chart-title">
          Distribution of Health Issues Across Occupation and Relationship
          Status
        </div>
        <div id="stackedBarChart"></div>
      </div>
      <div class="chart">
        <div class="chart-title">
          Health Issues Comparison by Occupation and Relationship Status
        </div>
        <div id="sideBySideBarChart"></div>
      </div>
    </div>

    <script>
      // Function to load data from JSON file
      async function loadData() {
        try {
          const response = await fetch("InteractiveViz.json");
          const data = await response.json();
          return data;
        } catch (error) {
          console.error("Error loading data:", error);
          return [];
        }
      }

      // Function to create the stacked bar chart
      function createStackedBarChart(data) {
        const margin = { top: 40, right: 100, bottom: 100, left: 60 };
        const width = 900 - margin.left - margin.right;
        const height = 600 - margin.top - margin.bottom;

        const svg = d3
          .select("#stackedBarChart")
          .append("svg")
          .attr("width", width + margin.left + margin.right)
          .attr("height", height + margin.top + margin.bottom)
          .append("g")
          .attr("transform", `translate(${margin.left},${margin.top})`);

        // Process data for stacked bar chart
        const healthIssues = [
          "Distraction",
          "Restlessness",
          "Anxiety",
          "ConcentrationDifficulty",
          "Depression",
          "Sleeplessness",
        ];
        const categories = Array.from(
          new Set(data.map((d) => d.RelationshipStatus))
        );

        const stackedData = categories.map((category) => {
          const categoryData = data.filter(
            (d) => d.RelationshipStatus === category
          );
          const result = { category: category };
          healthIssues.forEach((issue) => {
            result[issue] = d3.mean(categoryData, (d) => d[issue]);
          });
          return result;
        });

        const stack = d3.stack().keys(healthIssues);
        const series = stack(stackedData);

        const x = d3
          .scaleBand()
          .domain(categories)
          .range([0, width])
          .padding(0.1);

        const y = d3
          .scaleLinear()
          .domain([0, d3.max(series, (d) => d3.max(d, (d) => d[1]))])
          .range([height, 0]);

        const color = d3
          .scaleOrdinal()
          .domain(healthIssues)
          .range(d3.schemeCategory10);

        svg
          .selectAll("g")
          .data(series)
          .enter()
          .append("g")
          .attr("fill", (d) => color(d.key))
          .selectAll("rect")
          .data((d) => d)
          .enter()
          .append("rect")
          .attr("x", (d) => x(d.data.category))
          .attr("y", (d) => y(d[1]))
          .attr("height", (d) => y(d[0]) - y(d[1]))
          .attr("width", x.bandwidth());

        svg
          .append("g")
          .attr("transform", `translate(0,${height})`)
          .call(d3.axisBottom(x))
          .selectAll("text")
          .attr("transform", "rotate(-45)")
          .style("text-anchor", "end");

        svg.append("g").call(d3.axisLeft(y));

        // Add X axis label
        svg
          .append("text")
          .attr("class", "axis-label")
          .attr("text-anchor", "middle")
          .attr("x", width / 2)
          .attr("y", height + margin.bottom - 5)
          .text("Occupation - Relationship Status");

        // Add Y axis label
        svg
          .append("text")
          .attr("class", "axis-label")
          .attr("text-anchor", "middle")
          .attr("transform", "rotate(-90)")
          .attr("y", -margin.left + 20)
          .attr("x", -height / 2)
          .text("Average Score");

        // Add legend
        const legend = svg
          .append("g")
          .attr("class", "legend")
          .attr("font-family", "sans-serif")
          .attr("font-size", 10)
          .attr("text-anchor", "end")
          .selectAll("g")
          .data(healthIssues.slice().reverse())
          .enter()
          .append("g")
          .attr("transform", (d, i) => `translate(0,${i * 20})`);

        legend
          .append("rect")
          .attr("x", width + 70)
          .attr("width", 19)
          .attr("height", 19)
          .attr("fill", color);

        legend
          .append("text")
          .attr("x", width + 65)
          .attr("y", 9.5)
          .attr("dy", "0.32em")
          .text((d) => d);
      }

      // Function to create the side-by-side bar chart
      function createSideBySideBarChart(data) {
        const margin = { top: 40, right: 100, bottom: 60, left: 60 };
        const width = 900 - margin.left - margin.right;
        const height = 600 - margin.top - margin.bottom;

        const svg = d3
          .select("#sideBySideBarChart")
          .append("svg")
          .attr("width", width + margin.left + margin.right)
          .attr("height", height + margin.top + margin.bottom)
          .append("g")
          .attr("transform", `translate(${margin.left},${margin.top})`);

        // Process data for side-by-side bar chart
        const healthIssues = [
          "Distraction",
          "Restlessness",
          "Anxiety",
          "ConcentrationDifficulty",
          "Depression",
          "Sleeplessness",
        ];
        const categories = Array.from(new Set(data.map((d) => d.Occupation)));

        const chartData = categories.flatMap((category) => {
          const categoryData = data.filter((d) => d.Occupation === category);
          return healthIssues.map((issue) => ({
            category: category,
            issue: issue,
            value: d3.mean(categoryData, (d) => d[issue]),
          }));
        });

        const x0 = d3
          .scaleBand()
          .domain(categories)
          .range([0, width])
          .padding(0.1);

        const x1 = d3
          .scaleBand()
          .domain(healthIssues)
          .range([0, x0.bandwidth()])
          .padding(0.05);

        const y = d3
          .scaleLinear()
          .domain([0, d3.max(chartData, (d) => d.value)])
          .range([height, 0]);

        const color = d3
          .scaleOrdinal()
          .domain(healthIssues)
          .range(d3.schemeCategory10);

        svg
          .append("g")
          .selectAll("g")
          .data(chartData)
          .enter()
          .append("rect")
          .attr("x", (d) => x0(d.category) + x1(d.issue))
          .attr("y", (d) => y(d.value))
          .attr("width", x1.bandwidth())
          .attr("height", (d) => height - y(d.value))
          .attr("fill", (d) => color(d.issue));

        svg
          .append("g")
          .attr("transform", `translate(0,${height})`)
          .call(d3.axisBottom(x0))
          .selectAll("text")
          .attr("transform", "rotate(-45)")
          .style("text-anchor", "end");

        svg.append("g").call(d3.axisLeft(y));

        // Add X axis label
        svg
          .append("text")
          .attr("class", "axis-label")
          .attr("text-anchor", "middle")
          .attr("x", width / 2)
          .attr("y", height + margin.bottom - 5)
          .text("Occupation");

        // Add Y axis label
        svg
          .append("text")
          .attr("class", "axis-label")
          .attr("text-anchor", "middle")
          .attr("transform", "rotate(-90)")
          .attr("y", -margin.left + 20)
          .attr("x", -height / 2)
          .text("Average Score");

        // Add legend
        const legend = svg
          .append("g")
          .attr("class", "legend")
          .attr("font-family", "sans-serif")
          .attr("font-size", 10)
          .attr("text-anchor", "end")
          .selectAll("g")
          .data(healthIssues.slice().reverse())
          .enter()
          .append("g")
          .attr("transform", (d, i) => `translate(0,${i * 20})`);

        legend
          .append("rect")
          .attr("x", width + 70)
          .attr("width", 19)
          .attr("height", 19)
          .attr("fill", color);

        legend
          .append("text")
          .attr("x", width + 65)
          .attr("y", 9.5)
          .attr("dy", "0.32em")
          .text((d) => d);
      }

      // Load data and create charts
      loadData().then((data) => {
        createStackedBarChart(data);
        createSideBySideBarChart(data);
      });
    </script>
  </body>
</html>
